<!DOCTYPE html>
<html>
    <head>
        <title>Pintograph simulation</title>
    </head>
    <body style="background: black;">
        <button id="step" style="position: fixed; z-index: 2; left: 10px">Step</button>
        <button id="run" style="position: fixed; z-index: 2; left: 100px">Run</button>
        <button id="runFast" style="position: fixed; z-index: 2; left: 190px">Run fast</button>
       
        <canvas id="canvas" width="1000" height="1000" style="position: absolute; top: 0; left: 0; z-index: 0;"></canvas>
        <canvas id="overlay" width="1000" height="1000" style="position: absolute; top: 0; left: 0; z-index: 1;"></canvas>

        <script src="Maths.js"></script>
        <script src="FixedDrive.js"></script>
        <script src="CircularDrive.js"></script>
        <script src="DoubleCircularDrive.js"></script>
        <script src="SimpleArms.js"></script>
        <script src="SimplePen.js"></script>
        <script src="RainbowPen.js"></script>
        <script src="Simulation.js"></script>
        
        <script type="text/javascript">
            var driveA = new DoubleCircularDrive({
                position: {x: 300, y: 800},
                radius: 100,
                startingAngle: 0,
                rpm: -8,
                innerDrive: new CircularDrive({                   
                    position: {x: 500, y: 800},
                    radius: 100,
                    startingAngle: 180,
                    rpm: -4                  
                })
            });

            var driveB = new DoubleCircularDrive({
                position: {x: 700, y: 800},
                radius: 100,
                startingAngle: 0,
                rpm: 8,
                innerDrive: new CircularDrive({                   
                    position: {x: 500, y: 800},
                    radius: 100,
                    startingAngle: 180,
                    rpm: 16.02             
                })
            });
            
            var arms = new SimpleArms(driveA, driveB, 600, 600);
            
            var pen = new SimplePen(arms, "rgba(255,255,255,0.15)");
            
            var simulation = new Simulation(driveA, driveB, arms, pen, 30);

            var canvas = document.getElementById('canvas');
            var drawingContext = canvas.getContext('2d');

            var overlayCanvas = document.getElementById('overlay');
            var overlayContext = overlayCanvas.getContext('2d');
            
            var hue = 150;

            function simulate(repeat) {
                simulation.step();
                simulation.draw(drawingContext);

                if (repeat) {
                    requestAnimationFrame(simulate);
                    requestAnimationFrame(overlay);
                } else {
                    overlay();
                }
            }

            function overlay() {
                overlayContext.clearRect(0, 0, 1000, 1000);
                simulation.drawTools(overlayContext);
            }

            document.getElementById("step").addEventListener("click", function() {
                simulate(false);
            });
            
            document.getElementById("run").addEventListener("click", function() {
                simulate(true);
            });
            
            document.getElementById("runFast").addEventListener("click", function() {
                for (var i = 0; i < 50; ++i) {                    
                    simulate(true);
                }
            });

        </script>
    </body>
</html>